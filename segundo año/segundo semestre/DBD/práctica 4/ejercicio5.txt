Ejercicio 5
Agencia = (razon_social, dirección, telef, email)
Ciudad = (codigo_postal, nombreCiudad, anioCreacion)
Cliente = (dni, nombre, apellido, telefono, direccion)
Viaje = (fecha, hora, dni (fk), cpOrigen(fk), cpDestino(fk), razon_social(fk), descripcion) //cpOrigen y
cpDestino corresponden a la ciudades origen y destino del viaje

1. Listar razón social, dirección y teléfono de agencias que realizaron viajes desde la ciudad de ‘La
Plata’ (ciudad origen) y que el cliente tenga apellido ‘Roma’. Ordenar por razón social y luego por
teléfono.


SELECT a.razon_social, a.direccion, a.telef
FROM Agencia a 
INNER JOIN Viaje v ON a.razon_social = v.razon_social
INNER JOIN Cliente c ON v.dni = c.dni
INNER JOIN Ciudad ci ON ci.codigo_postal= v.cpOrigen
WHERE ci.nombreCiudad="La Plata" and c.apellido="Roma"


2. Listar fecha, hora, datos personales del cliente, nombres de ciudades origen y destino de viajes
realizados en enero de 2019 donde la descripción del viaje contenga el String ‘demorado’.


SELECT v.fecha, v.hora, c.dni, c.nombre, c.apellido, c.telefono, c.direccion, ci1.nombreCiudad, ci2.nombreCiudad
FROM Viaje v
INNER JOIN Cliente c ON v.DNI = c.DNI
INNER JOIN Ciudad ci1 ON v.cpOrigen = ci1.codigo_postal
INNER JOIN Ciudad ci2 ON v.cpDestino = ci2.codigo_postal
WHERE MONTH(v.fecha) = 1 and YEAR (v.fecha) = 2019 and v.descripcion LIKE '%demorado%'


3. Reportar información de agencias que realizaron viajes durante 2019 o que tengan dirección de
mail que termine con ‘@jmail.com’.


SELECT DISTINCT a.*
FROM Agencia a
WHERE a.email LIKE '%@jmail.com'
   OR EXISTS (
       SELECT *
       FROM Viaje v
       WHERE v.razon_social = a.razon_social AND YEAR(v.fecha) = 2019
);


4. Listar datos personales de clientes que viajaron solo con destino a la ciudad de ‘Coronel
Brandsen’


SELECT c.*
FROM Cliente c
WHERE EXISTS (
SELECT *
FROM Viaje v1
INNER JOIN Ciudad c1 ON v1.cpDestino = c1.codigo_postal
WHERE c.dni = v1.dni and c1.nombreCiudad="Coronel Brandsen"
)
AND NOT EXISTS (
SELECT *
FROM Viaje v2
INNER JOIN Ciudad c2 ON v2.cpDestino = c2.codigo_postal
WHERE c.dni = v2.dni and c2.nombreCiudad<>"Coronel Brandsen"
);


5. Informar cantidad de viajes de la agencia con razón social ‘TAXI Y’ realizados a ‘Villa Elisa’.


SELECT COUNT(*)as cantidad
FROM Agencia a
INNER JOIN Viaje v on a.razon_social = v.razon_social
INNER JOIN Ciudad c on v.cpDestino = c.codigo_postal
WHERE a.razon_social="TAXI Y" and c.nombreCiudad="Villa Elisa"


6. Listar nombre, apellido, dirección y teléfono de clientes que viajaron con todas las agencias.


SELECT c.nombre, c.apellido, c.direccion, c.telefono
FROM Cliente c
WHERE NOT EXISTS (
    SELECT *
    FROM Agencia a
    WHERE NOT EXISTS (
        SELECT *
        FROM Viaje v
        WHERE v.dni = c.dni
          AND v.razon_social = a.razon_social
    )
);



7. Modificar el cliente con DNI 38495444 actualizando el teléfono a ‘221-4400897’.


UPDATE Cliente SET telefono = '221-4400897' WHERE dni=38495444;


8. Listar razón social, dirección y teléfono de la/s agencias que tengan mayor cantidad de viajes
realizados.


SELECT a.razon_social, a.direccion, a.telef
FROM Agencia a INNER JOIN Viaje v ON (a.razon_social = v.razon_social)
GROUP BY a.razon_social, a.direccion, a.telef
/* Buscar maximo */
HAVING COUNT(*) >= ALL (
    SELECT COUNT(*)
    FROM Viaje v
    GROUP BY v.razon_social
);



9. Reportar nombre, apellido, dirección y teléfono de clientes con al menos 5 viajes.


SELECT c.nombre, c.apellido, c.direccion, c.telefono
FROM Cliente c
INNER JOIN Viaje v ON c.dni = v.dni
GROUP BY c.nombre, c.apellido, c.direccion, c.telefono
HAVING COUNT(*) >= 5;



10. Borrar al cliente con DNI 40325692.

DELETE FROM Viaje WHERE dni=40325692;
DELETE FROM Cliente WHERE dni=40325692;

